---
layout: post
categories: ko
---

![homelabbity](img/homelabbity.png)

아주 오래전부터 학교를 포함한 거의 모든 문서작업이나 파일 관리에 독점적으로 구글 드라이브를 쓰고있었다. 15GB가 아직까지는 부족함은 없었지만, 구글 포토가 용량에 포함되도록 바뀜과 동시에 파일들도 쌓여가면서 장기적으로 용량 제한을 걱정하게되었다. 사실 구글 포토만 생각하면 월 2천원정도는 충분히 낼 가치가 있다고 생각하지만, 지난 학기의 자료들이라든가 하는, 지울 수는 없지만 쓰지도 않아 용량만 차지하는 파일들이 그 용량을 차지하는게 마음에 들지 않았다.

가장 간단하게는 USB나 외장하드를 사용 할 수 있다. 어차피 자주 쓸 일이 없는 파일들을 보관하는게 목적이기때문에 사실 이 방법이 제일 합리적인 것 같다. 하지만 별로 재미가 없으니 홈서버로 NAS를 운영하기로 결심했다.

먼저 하드웨어는 어찌 구한 라이젠 2200g를 사용하게 되었다. NAS 용도라면 차고 넘치고, Jellyfin과 같은 스트리밍 서비스도 문제없이 사용 할 수 있다. 스트리밍이 주목적이라면 인텔 CPU가 조금 더 낫긴하다. 사실 하드웨어는 별로 선택의 여지가 없었기에 SSD에 OS를 설치하고 HDD를 주요 스토리지로 사용하는 것 정도만 결정했다.

이제 서버를 어떻게 구축할지가 관건이었다. 이전부터 Proxmox를 사용해보고싶었는데, 4코어 CPU와 8gb램에는 조금 필요이상이라는 생각이 들었다. 네트워킹도 홈서버 특성상 까다로워 Proxmox를 사용하기 어렵기도 했다. 라즈베리파이나 VPS들을 사용하면서 Ubuntu Server가 가장 익숙했지만, 새롭게 시작하는 서버인만큼 익숙한 방법에서 조금 벗어나고싶었다. 하지만 결국 여러 시도끝에 Debian 기반의 OpenMediaVault를 사용하기로 결정했는데, 그냥 Ubuntu랑은 다른, 그래도 새로운 시도를 했다는 점에서 만족하려한다.

![OpenMediaVault](img/omv.png)

그런데 OpenMediaVault는 오히려 디스크 관리 등이 GUI를 통해 더 편리하다보니 새로운 것을 배워가는 느낌은 덜하다. 오히려 이번 기회를 통해 Docker를 조금 더 적극적으로 사용하게되었다. 네트워킹이 제한되다보니 Docker같은 서비스가 정말 감사했다. 특히 OMV에 Portainer를 비롯한 Docker 시스템이 잘 연동되어있어 사용성이 우수했다. Proxmox처럼 Full VM은 아니지만 Docker가 워낙 많이 쓰이다보니 부족함은 없었다.

홈서버는 본가에 있어 외부에서의 접근이 필수적이었다. 문제는 OMV에서 기본적으로 제공하는 FTP나 SMB같은 솔루션은 보안에 심각한 문제가 있다는 것이다. SFTP를 고려해볼수 있지만 이전부터 해보고싶었던 Nextcloud를 사용하기로 결정했다. 제대로만 설정해준다면 가장 안전한 방법인것같다. Docker Image는 linuxserver.io가 아닌 공식 이미지를 사용했다. linuxserver.io의 이미지는 조금 더 직관적인 설정이 가능했지만 CODE Server를 사용하지 못한다는 단점이 있어 사용하지 않았다. DB는 MariaDB를 사용했고, Nginx Proxy Manager 뒤에 두어 도메인으로 접근 할 수 있도록 했다. Shared Folder를 Nextcloud와 아카이브용 폴더로 각각 나누어 아카이브용 "Vault"는 External storage로, Nextcloud 폴더는 Nextcloud 데이터를 저장하는 데에 사용하였다. 처음 구축에는 권한 문제, SSL문제로 여러 고난을 겪었지만 지금은 대부분의 문제를 해결해 안정화된상태이다. Portainer가 정말 직관적이고 안정적이라 Troubleshooting이 정말 빨리 이루어질 수 있었다.

![Portainer](img/portainer.png)

이제 (나름) 제대로된 Homelab을 가졌으니 아주 재밌게 놀 수 있을 것 같다. 그냥 USB로 해결될 문제였겠지만, 없는 문제를 만들어 푸는 것 만큼 재밌는 취미가 없는 것 같다.