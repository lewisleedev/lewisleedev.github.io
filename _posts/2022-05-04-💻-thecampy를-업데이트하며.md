---
layout: post
categories: ko
---

처음 군대 사지방에서 thecampy를 개발하기 시작한지 1년하고도 4개월이 지났다. node보다 python이 쓰기 쉬워서 만들었던게 수준에 맞지 않게 의외로 많은 분들이 써주셨던 것 같다.

제대로 배워본 적도 없고 취미로만 하던 코딩이라 미흡하고 버그도 많았지만 최대한 노력하면서 써갔던 것 같다. 돌아보면 그런 열악한 환경에서 개발을 위해 많은 시행착오를 겪었고, 그 과정에서도 정말 많은 것을 배울 수 있었다.

thecampy는 그런 점에서 여러모로 각별하다. 이미 전역도 했고, 인편을 쓸 사람도 주변에 없지만 계속 유지/보수를 하려한다. 근래에 더캠프에서 카페 확인의 response값을 바꾼 후 제대로 작동을 하지 않게되었는데, 이것을 해결하기위해 어떤 과정을 거쳤는지 잠깐 설명을 해보려고 한다.

![더캠프 api 구성](img/thecamp_api.jpg)

먼저 더캠프는 보고싶은 군인으로 훈련병을 등록 후, 카페개설을 확인과 동시에 가입해야 위문편지를 보낼 수 있게 되어있다. 기존의 방식대로면 카페 개설을 확인할 때, response로 훈련병 개인 식별코드를 반환했었고, 이를 위문편지작성 request에 같이 넣어 보내주면 됐었다. 보고싶은 군인 등록은 신상정보의 진위를 확인하거나 하는 과정 없이 이루어지고, 실질적으로 훈련병을 확인하는 것은 카페개설확인 시점이다.

![이런것도 된다](img/fake_name_thecamp.png)

문제는 카페 개설 확인을

```
(...) href="javascript:fn_cafeCreateCheck('4','홍길동','20210420','qFBELKZqlhwdWYsPeXwo4Q==','0000140002','20120180100','0000010001', '0000420006');" (...)
```

이렇게 ajax request를 통해 하는데, 해당 링크에 request를 보내도 정상처리되었다라는 response만 받을 뿐, 실제로 개설이 확인이되고 가입이 되질 않는다. 그리고 중간에 `birth`라는 parameter가 존재하는데, `qFBELKZqlhwdWYsPeXwo4Q==` 이 부분이 임의로 만들어낸 병사 홍길동의 birth값이다. 여러 인코딩을 찾아봤지만 어떤 값인지 여전히 미지수이다. 임의로 생년월일을 숫자로 보내면 정상처리되었다고 response를 보내니 큰 문제는 아닌 것 처럼 보였다.

결국 카페 개설 확인은 포기하였다. 자연스럽게 병사 추가도 포기하게 되었다. 작동은 했지만 이전보다 더 불안해졌고(response가 들쭉날쭉했다), 의미가 없어졌기 때문이다. 다행히도 카페 가입 후 훈련병 식별코드를 찾을 방법은 구해냈는데, 바로 requests와 beautifulsoup을 이용한 크롤링이었다.

이전엔 몰랐는데, 교육생 기수마다 위문카페가 존재하고, 그 카페마다 부여되는 코드가 존재했다. 그 코드와 부대 코드를 위문편지 작성 버튼 링크에 같이 보내면, 훈련병 식별코드를 담고있는 위문편지함 페이지로 이동하게되고, 그 페이지를 크롤링해서 코드를 알아낼 수 있었다.

결국 깔끔한 방법은 아니지만, thecampy는 어떻게나마 유지시킬 수 있었다. 역시나 이번에도 많은 경험을 하며 ~~더캠프~~웹서비스에 대해 좀 더 깊은 이해를 가지게 된 것 같다.